# 2.4 關於跨網域

## 關於跨網域

預設上都是禁止跨網域取得資料的，老師伺服器上的一行( `.htaccess` )，加上註解( `#` 字號是註解)，如下：

```
# Header add Access-Control-Allow-Origin "*"
```

同學再執行 **`xmlhttprequest.html`** 試看看，會發現如下錯誤：

![](../.gitbook/assets/ajax\_cors\_blocked.png)



### CORS (跨網域資源共享)

CORS = Cross-Origin Resource Sharing

解決方式，設定 **`Access-Control-Allow-Origin`** 以及 **`Access-Control-Allow-Methods`** 這兩個表頭資訊。



第一種設定方式，以 Apache 的 **`.htaccess`** 檔為例：

```bash
Header add Access-Control-Allow-Origin "*"
Header add Access-Control-Allow-Methods "*"
```



第二種設定方式，以 PHP 程式個別檔案去設定：

```php
header('Access-Control-Allow-Origin: *');
header('Access-Control-Allow-Methods: *');
```







### JSONP (不建議)

JSONP = JSON with Padding

範例觀察：

一、建立 `ajax/practice/jsonp.html` 檔案，內容如下：

```markup
<!DOCTYPE html>
<html lang="zh-Hant">
  <head>
    <meta charset="utf-8">
    <title>JSONP</title>
  </head>
  <body>

    <script>
      // 從伺服器端取得的資料，預計由此函式來處理
      function handle_jsonp(data){
        console.log(data);
      }
    </script>
    <script src="http://notes.carlos-studio.com/ajax/teach/simple_jsonp.php?callback=handle_jsonp"></script>
  </body>
</html>
```

{% hint style="info" %}
留意 script 標籤上的網址，並不是 js 的程式，而是後端程式 PHP。

也就是若有回傳的文字，則會被當作 JS 程式來執行。
{% endhint %}



在老師伺服器上的一段 PHP 程式碼如下：

```php
<?php
header("Content-Type:text/html; charset=utf-8");
$arr = array("book_name" => "某某書本", "book_price" => 399, "book_author" => "某某作者");

//echo "for(let i = 0; i <= 9; i++){alert(i);}";

echo $_GET["callback"] . "(" . json_encode($arr) . ")";
?>
```

此程式碼會回傳，然後被當作 JS 程式來執行：

```javascript
handle_jsonp({"book_name":"某某書本","book_price":399,"book_author":"某某作者"})
```





執行看看：

執行 `http://127.0.0.1:3000/ajax/jsonp.html` 網址，在開發者工具的 Network 頁籤裡，觀察下圖：

![](../.gitbook/assets/jsonp\_network.png)

以及 console 中，的確有印出資料(如下圖)，因為有執行 handle\_jsonp 函式的關係，達成取得遠端伺服器資料的目的。

![](../.gitbook/assets/jsonp\_data.png)



{% hint style="warning" %}
不建議的理由：

* 安全性的問題。(老師移除 PHP 程式碼的第5行，植入其它 JS 程式。)
* 它並不是 ajax 技術。(在 network → XHR 看不到)
{% endhint %}

例：[Google Map JavaScript API：Simple Map](https://developers.google.com/maps/documentation/javascript/examples/map-simple#maps\_map\_simple-html)

